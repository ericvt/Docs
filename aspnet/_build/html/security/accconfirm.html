

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Account Confirmation and Password Recovery with ASP.NET Identity &mdash; ASP.NET 0.0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css?v=1" type="text/css" />
  

  
    <link rel="top" title="ASP.NET 0.0.1 documentation" href="../index.html"/>
        <link rel="up" title="Security" href="index.html"/>
        <link rel="next" title="Two-factor authentication with SMS using ASP.NET Identity" href="2fa.html"/>
        <link rel="prev" title="Enabling authentication using external providers" href="sociallogins.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ASP.NET
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conceptual-overview/index.html">Conceptual Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fundamentals/index.html">Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dnx/index.html">.NET Execution Environment (DNX)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frameworks/index.html">Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/index.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publishing/index.html">Publishing and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client-side/index.html">Client-Side Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/index.html">Mobile</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Security</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sociallogins.html">Enabling authentication using external providers</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Account Confirmation and Password Recovery with ASP.NET Identity</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="2fa.html">Two-factor authentication with SMS using ASP.NET Identity</a></li>
<li class="toctree-l2"><a class="reference internal" href="authorization/index.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="data-protection/index.html">Data Protection</a></li>
<li class="toctree-l2"><a class="reference internal" href="app-secrets.html">Safe Storage of Application Secrets</a></li>
<li class="toctree-l2"><a class="reference internal" href="anti-request-forgery.html">|stub-icon| Anti-Request Forgery</a></li>
<li class="toctree-l2"><a class="reference internal" href="open-redirect.html">|stub-icon| Preventing Open Redirect Attacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="cross-site-scripting.html">|stub-icon| Preventing Cross-Site Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="cors.html">Enabling Cross-Origin Requests (CORS)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration/index.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ASP.NET</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Security</a> &raquo;</li>
      
    <li>Account Confirmation and Password Recovery with ASP.NET Identity</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/security/accconfirm.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
  <div class="section" id="account-confirmation-and-password-recovery-with-asp-net-identity">
<h1>Account Confirmation and Password Recovery with ASP.NET Identity<a class="headerlink" href="#account-confirmation-and-password-recovery-with-asp-net-identity" title="Permalink to this headline">¶</a></h1>
<p>By <a class="reference external" href="https://github.com/rick-anderson">Rick Anderson</a></p>
<p>This tutorial shows you how to build an ASP.NET 5 Web site with email confirmation and password reset using ASP.NET Identity.</p>
<dl class="docutils">
<dt>In this article:</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#create-a-new-asp-net-5-project">Create a New ASP.NET 5 Project</a></li>
<li><a class="reference internal" href="#require-ssl">Require SSL</a></li>
<li><a class="reference internal" href="#require-email-confirmation">Require email confirmation</a></li>
<li><a class="reference internal" href="#configure-email-provider">Configure email provider</a></li>
<li><a class="reference internal" href="#enable-account-confirmation-and-password-recovery">Enable account confirmation and password recovery</a></li>
<li><a class="reference internal" href="#register-confirm-email-and-reset-password">Register, confirm email, and reset password</a></li>
<li><a class="reference internal" href="#require-email-confirmation-before-login">Require email confirmation before login</a></li>
<li><a class="reference internal" href="#combine-social-and-local-login-accounts">Combine social and local login accounts</a></li>
</ul>
</dd>
</dl>
<div class="section" id="create-a-new-asp-net-5-project">
<h2>Create a New ASP.NET 5 Project<a class="headerlink" href="#create-a-new-asp-net-5-project" title="Permalink to this headline">¶</a></h2>
<p>Create a new ASP.NET 5 web app with individual user accounts.</p>
<img alt="../_images/new-project.png" src="../_images/new-project.png" />
<p>Run the app and then click on the <strong>Register</strong> link and register a user. At this  point, the only validation on the email is with the <a class="reference external" href="http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx">[EmailAddress]</a> attribute. After you submit the registration, you are logged into the app. Later in the tutorial we&#8217;ll change this so new users cannot log in until their email has been validated.</p>
<p>In <strong>SQL Server Object Explorer</strong> (SSOX), navigate to <strong>(localdb)MSSQLLocalDB(SQL Server 12)</strong>. Right click on <strong>dbo.AspNetUsers</strong> &gt; <strong>View Data</strong>:</p>
<img alt="../_images/ssox.png" src="../_images/ssox.png" />
<img alt="../_images/au.png" src="../_images/au.png" />
<p>Note the <code class="docutils literal"><span class="pre">EmailConfirmed</span></code> field is <code class="docutils literal"><span class="pre">False</span></code>.</p>
<p>Right-click on the row and from the context menu, select <strong>Delete</strong>. You might want to use this email again in the next step, when the app sends a confirmation email. Deleting the email alias now will make it easier in the following steps.</p>
</div>
<div class="section" id="require-ssl">
<h2>Require SSL<a class="headerlink" href="#require-ssl" title="Permalink to this headline">¶</a></h2>
<p>In this section we&#8217;ll set up our Visual Studio project to use SSL and our project to require SSL.</p>
<div class="section" id="enable-ssl-in-visual-studio">
<h3>Enable SSL in Visual Studio<a class="headerlink" href="#enable-ssl-in-visual-studio" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>From the <strong>Project</strong> menu, select <strong>Web app Properties</strong>.</li>
<li>Select <strong>Debug</strong> in the left pane (see image below).</li>
<li>Check <strong>Enable SSL</strong>, and then save changes (this step is necessary to populate the URL box).</li>
<li>Copy the <strong>URL</strong> and paste it into the <strong>Launch URL</strong> box.</li>
</ol>
<img alt="../_images/ssl.png" src="../_images/ssl.png" />
</div>
<div class="section" id="require-https">
<h3>Require HTTPS<a class="headerlink" href="#require-https" title="Permalink to this headline">¶</a></h3>
<p>Add the <code class="docutils literal"><span class="pre">[RequireHttps]</span></code> attribute to each controller. The <code class="docutils literal"><span class="pre">[RequireHttps]</span></code> attribute will redirect all HTTP GET requests to HTTPS GET and will reject all HTTP POSTs. A security best practice is to use HTTPS for all requests.</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="na">[RequireHttps]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">HomeController</span> <span class="p">:</span> <span class="n">Controller</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="require-email-confirmation">
<h2>Require email confirmation<a class="headerlink" href="#require-email-confirmation" title="Permalink to this headline">¶</a></h2>
<p>It&#8217;s a best practice to confirm the email of a new user registration to verify they are not impersonating someone else (that is, they haven&#8217;t registered with someone else&#8217;s email). Suppose you had a discussion forum, you would want to prevent &#8220;<a class="reference external" href="mailto:bob&#37;&#52;&#48;example&#46;com">bob<span>&#64;</span>example<span>&#46;</span>com</a>&#8221; from registering as &#8220;<a class="reference external" href="mailto:joe&#37;&#52;&#48;contoso&#46;com">joe<span>&#64;</span>contoso<span>&#46;</span>com</a>&#8221;. Without email confirmation, &#8220;<a class="reference external" href="mailto:joe&#37;&#52;&#48;contoso&#46;com">joe<span>&#64;</span>contoso<span>&#46;</span>com</a>&#8221; could get unwanted email from your app. Suppose Bob accidentally registered as  &#8220;<a class="reference external" href="mailto:bib&#37;&#52;&#48;example&#46;com">bib<span>&#64;</span>example<span>&#46;</span>com</a>&#8221; and hadn&#8217;t noticed it, he wouldn&#8217;t be able to use password recovery because the app doesn&#8217;t have his correct email. Email confirmation provides only limited protection from bots and doesn&#8217;t provide protection from determined spammers who have many working email aliases they can use to register.</p>
<p>You generally want to prevent new users from posting any data to your web site before they have been confirmed by email, an SMS text message, or another mechanism. In the sections below, we will enable email confirmation and modify the code to prevent newly registered  users from logging in until their email has been confirmed.</p>
<div class="section" id="configure-email-provider">
<h3>Configure email provider<a class="headerlink" href="#configure-email-provider" title="Permalink to this headline">¶</a></h3>
<p>We&#8217;ll use the <a class="reference internal" href="../fundamentals/configuration.html#options-config-objects"><span>Options pattern</span></a> to access the user account and key settings. For more information, see <a class="reference internal" href="../fundamentals/configuration.html"><em>Configuration</em></a>.</p>
<blockquote>
<div><ul class="simple">
<li>Create a class to fetch the secure email key. For this sample, the <code class="docutils literal"><span class="pre">AuthMessageSenderOptions</span></code> class is created in the <em>Services/AuthMessageSenderOptions.cs</em> file.</li>
</ul>
<blockquote>
<div><div class="highlight-c#"><div class="highlight"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">AuthMessageSenderOptions</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">SendGridUser</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">SendGridKey</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p>Set the <code class="docutils literal"><span class="pre">SendGridUser</span></code> and <code class="docutils literal"><span class="pre">SendGridKey</span></code> with the <a class="reference external" href="http://docs.asp.net/en/latest/security/app-secrets.html">secret-manager tool</a>. For example:</p>
<div class="highlight-none"><div class="highlight"><pre>C:\WebApplication1\src\WebApplication1&gt;user-secret set SendGridUser RickAndMSFT
info: Successfully saved SendGridUser = RickAndMSFT to the secret store.
</pre></div>
</div>
<p>On Windows, Secret Manager stores your keys/value pairs in a <em>secrets.json</em> file in the %APPDATA%/Microsoft/UserSecrets/&lt;<strong>userSecretsId</strong>&gt; directory. The <strong>userSecretsId</strong> directory can be found in your <em>project.json</em> file. For this example, the first few lines of the <em>project.json</em> file are shown below:</p>
<blockquote>
<div><div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
  <span class="nt">&quot;webroot&quot;</span><span class="p">:</span> <span class="s2">&quot;wwwroot&quot;</span><span class="p">,</span>
<span class="hll">  <span class="nt">&quot;userSecretsId&quot;</span><span class="p">:</span> <span class="s2">&quot;aspnet5-WebApplication1-df49bbe3-19e1-41d7-9fc8-059067304c31&quot;</span><span class="p">,</span>
</span>  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0-*&quot;</span><span class="p">,</span>

    <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
</pre></div>
</div>
</div></blockquote>
<p>At this time, the contents of the <em>project.json</em> file are not encrypted. The <em>project.json</em> file is shown below (the sensitive keys have been removed.)</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
  <span class="nt">&quot;SendGridUser&quot;</span><span class="p">:</span> <span class="s2">&quot;RickAndMSFT&quot;</span><span class="p">,</span>
  <span class="nt">&quot;SendGridKey&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Authentication:Facebook:AppId&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Authentication:Facebook:AppSecret&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-startup-to-use-authmessagesenderoptions">
<h3>Configure startup to use <code class="docutils literal"><span class="pre">AuthMessageSenderOptions</span></code><a class="headerlink" href="#configure-startup-to-use-authmessagesenderoptions" title="Permalink to this headline">¶</a></h3>
<p>Add <code class="docutils literal"><span class="pre">AuthMessageSenderOptions</span></code> to the service container at the end of the <code class="docutils literal"><span class="pre">ConfigureServices</span></code> method in the <em>Startup.cs</em> file:</p>
<div class="highlight-c#"><div class="highlight"><pre>    <span class="c1">// Register application services.</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IEmailSender</span><span class="p">,</span> <span class="n">AuthMessageSender</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">ISmsSender</span><span class="p">,</span> <span class="n">AuthMessageSender</span><span class="p">&gt;();</span>
<span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">Configure</span><span class="p">&lt;</span><span class="n">AuthMessageSenderOptions</span><span class="p">&gt;(</span><span class="n">Configuration</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-the-authmessagesender-class">
<h3>Configure the <code class="docutils literal"><span class="pre">AuthMessageSender</span></code> class<a class="headerlink" href="#configure-the-authmessagesender-class" title="Permalink to this headline">¶</a></h3>
<p>This tutorial shows how to add email notification through <a class="reference external" href="https://sendgrid.com/">SendGrid</a>, but you can send email using SMTP and other mechanisms.</p>
<ul class="simple">
<li>Install the SendGrid NuGet package. From the Package Manager Console,  enter the following the following command:</li>
</ul>
<blockquote>
<div><code class="docutils literal"><span class="pre">Install-Package</span> <span class="pre">SendGrid</span></code></div></blockquote>
<ul class="simple">
<li>Follow the instructions <a class="reference external" href="https://azure.microsoft.com/en-us/documentation/articles/sendgrid-dotnet-how-to-send-email/#create-a-sendgrid-account">Create a SendGrid account</a> to register for a free SendGrid account.</li>
<li>Add code in <em>Services/MessageServices.cs</em> similar to the following to configure SendGrid</li>
</ul>
<div class="highlight-c#"><div class="highlight"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">AuthMessageSender</span> <span class="p">:</span> <span class="n">IEmailSender</span><span class="p">,</span> <span class="n">ISmsSender</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">AuthMessageSender</span><span class="p">(</span><span class="n">IOptions</span><span class="p">&lt;</span><span class="n">AuthMessageSenderOptions</span><span class="p">&gt;</span> <span class="n">optionsAccessor</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Options</span> <span class="p">=</span> <span class="n">optionsAccessor</span><span class="p">.</span><span class="n">Options</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">AuthMessageSenderOptions</span> <span class="n">Options</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>  <span class="c1">// set only via Secret Manager</span>

    <span class="k">public</span> <span class="n">Task</span> <span class="nf">SendEmailAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">email</span><span class="p">,</span> <span class="kt">string</span> <span class="n">subject</span><span class="p">,</span> <span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Plug in your email service here to send an email.</span>
        <span class="kt">var</span> <span class="n">myMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SendGrid</span><span class="p">.</span><span class="n">SendGridMessage</span><span class="p">();</span>
        <span class="n">myMessage</span><span class="p">.</span><span class="n">AddTo</span><span class="p">(</span><span class="n">email</span><span class="p">);</span>
        <span class="n">myMessage</span><span class="p">.</span><span class="n">From</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Mail</span><span class="p">.</span><span class="n">MailAddress</span><span class="p">(</span><span class="s">&quot;Joe@contoso.com&quot;</span><span class="p">,</span> <span class="s">&quot;Joe Smith&quot;</span><span class="p">);</span>
        <span class="n">myMessage</span><span class="p">.</span><span class="n">Subject</span> <span class="p">=</span> <span class="n">subject</span><span class="p">;</span>
        <span class="n">myMessage</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">message</span><span class="p">;</span>
        <span class="n">myMessage</span><span class="p">.</span><span class="n">Html</span> <span class="p">=</span> <span class="n">message</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">credentials</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">NetworkCredential</span><span class="p">(</span>
            <span class="n">Options</span><span class="p">.</span><span class="n">SendGridUser</span><span class="p">,</span>
            <span class="n">Options</span><span class="p">.</span><span class="n">SendGridKey</span><span class="p">);</span>
        <span class="c1">// Create a Web transport for sending email.</span>
        <span class="kt">var</span> <span class="n">transportWeb</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SendGrid</span><span class="p">.</span><span class="n">Web</span><span class="p">(</span><span class="n">credentials</span><span class="p">);</span>
        <span class="c1">// Send the email.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">transportWeb</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">transportWeb</span><span class="p">.</span><span class="n">DeliverAsync</span><span class="p">(</span><span class="n">myMessage</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="n">FromResult</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">Task</span> <span class="nf">SendSmsAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">number</span><span class="p">,</span> <span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Plug in your SMS service here to send a text message.</span>
        <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="n">FromResult</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">SendGrid doesn&#8217;t currently target dnxcore50: If you build your project you will get compilation errors. This is because SendGrid does not have a package for dnxcore50 and some APIs such as System.Mail are not available on .NET Core. You can remove dnxcore50 from <em>project.json</em> or call the REST API from SendGrid to send email. The code below shows the updated <em>project.json</em> file with <code class="docutils literal"><span class="pre">&quot;dnxcore50&quot;:</span> <span class="pre">{</span> <span class="pre">}</span></code> removed.</p>
</div>
<div class="highlight-json"><div class="highlight"><pre>       &quot;frameworks&quot;: {
  &quot;dnx451&quot;: { }
},
</pre></div>
</div>
</div>
</div>
<div class="section" id="enable-account-confirmation-and-password-recovery">
<h2>Enable account confirmation and password recovery<a class="headerlink" href="#enable-account-confirmation-and-password-recovery" title="Permalink to this headline">¶</a></h2>
<p>The template already has the code for account confirmation and password recovery. Follow these steps to enable it:</p>
<ul class="simple">
<li>Find the <code class="docutils literal"><span class="pre">[HttpPost]</span> <span class="pre">Register</span></code> method in the  <em>AccountController.cs</em> file.</li>
<li>Uncomment the code to enable account confirmation.</li>
</ul>
<div class="highlight-c#"><div class="highlight"><pre><span class="c1">//</span>
<span class="c1">// POST: /Account/Register</span>
<span class="na">[HttpPost]</span>
<span class="na">[AllowAnonymous]</span>
<span class="na">[ValidateAntiForgeryToken]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="n">Register</span><span class="p">(</span><span class="n">RegisterViewModel</span> <span class="n">model</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">EnsureDatabaseCreated</span><span class="p">(</span><span class="n">_applicationDbContext</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ApplicationUser</span> <span class="p">{</span> <span class="n">UserName</span> <span class="p">=</span> <span class="n">model</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span> <span class="n">Email</span> <span class="p">=</span> <span class="n">model</span><span class="p">.</span><span class="n">Email</span> <span class="p">};</span>
        <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="n">CreateAsync</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">Password</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Succeeded</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// For more information on how to enable account confirmation and password reset please visit http://go.microsoft.com/fwlink/?LinkID=532713</span>
            <span class="c1">// Send an email with this link</span>
<span class="hll">            <span class="kt">var</span> <span class="n">code</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="n">GenerateEmailConfirmationTokenAsync</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
</span><span class="hll">            <span class="kt">var</span> <span class="n">callbackUrl</span> <span class="p">=</span> <span class="n">Url</span><span class="p">.</span><span class="n">Action</span><span class="p">(</span><span class="s">&quot;ConfirmEmail&quot;</span><span class="p">,</span> <span class="s">&quot;Account&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">userId</span> <span class="p">=</span> <span class="n">user</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">code</span> <span class="p">=</span> <span class="n">code</span> <span class="p">},</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">Context</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Scheme</span><span class="p">);</span>
</span><span class="hll">            <span class="k">await</span> <span class="n">_emailSender</span><span class="p">.</span><span class="n">SendEmailAsync</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span> <span class="s">&quot;Confirm your account&quot;</span><span class="p">,</span>
</span><span class="hll">                <span class="s">&quot;Please confirm your account by clicking this link: &lt;a href=\&quot;&quot;</span> <span class="p">+</span> <span class="n">callbackUrl</span> <span class="p">+</span> <span class="s">&quot;\&quot;&gt;link&lt;/a&gt;&quot;</span><span class="p">);</span>
</span><span class="hll">            <span class="c1">//await _signInManager.SignInAsync(user, isPersistent: false);</span>
</span>            <span class="k">return</span> <span class="nf">RedirectToAction</span><span class="p">(</span><span class="n">nameof</span><span class="p">(</span><span class="n">HomeController</span><span class="p">.</span><span class="n">Index</span><span class="p">),</span> <span class="s">&quot;Home&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">AddErrors</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// If we got this far, something failed, redisplay form</span>
    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Note:</strong> We&#8217;re also preventing a newly registered user from being automatically logged on by commenting out the following line:</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="c1">//await _signInManager.SignInAsync(user, isPersistent: false);</span>
</pre></div>
</div>
<ul class="simple">
<li>Enable password recovery by uncommenting the code in the <code class="docutils literal"><span class="pre">ForgotPassword</span></code> action in the <em>Controllers/AccountController.cs</em> file.</li>
</ul>
<div class="highlight-c#"><div class="highlight"><pre><span class="c1">//</span>
<span class="c1">// POST: /Account/ForgotPassword</span>
<span class="na">[HttpPost]</span>
<span class="na">[AllowAnonymous]</span>
<span class="na">[ValidateAntiForgeryToken]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="n">ForgotPassword</span><span class="p">(</span><span class="n">ForgotPasswordViewModel</span> <span class="n">model</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="n">FindByNameAsync</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">Email</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">user</span> <span class="p">==</span> <span class="k">null</span> <span class="p">||</span> <span class="p">!(</span><span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="n">IsEmailConfirmedAsync</span><span class="p">(</span><span class="n">user</span><span class="p">)))</span>
        <span class="p">{</span>
            <span class="c1">// Don&#39;t reveal that the user does not exist or is not confirmed</span>
            <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="s">&quot;ForgotPasswordConfirmation&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// For more information on how to enable account confirmation and password reset please visit http://go.microsoft.com/fwlink/?LinkID=532713</span>
        <span class="c1">// Send an email with this link</span>
<span class="hll">        <span class="kt">var</span> <span class="n">code</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="n">GeneratePasswordResetTokenAsync</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
</span><span class="hll">        <span class="kt">var</span> <span class="n">callbackUrl</span> <span class="p">=</span> <span class="n">Url</span><span class="p">.</span><span class="n">Action</span><span class="p">(</span><span class="s">&quot;ResetPassword&quot;</span><span class="p">,</span> <span class="s">&quot;Account&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">userId</span> <span class="p">=</span> <span class="n">user</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">code</span> <span class="p">=</span> <span class="n">code</span> <span class="p">},</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">Context</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Scheme</span><span class="p">);</span>
</span><span class="hll">        <span class="k">await</span> <span class="n">_emailSender</span><span class="p">.</span><span class="n">SendEmailAsync</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span> <span class="s">&quot;Reset Password&quot;</span><span class="p">,</span>
</span><span class="hll">           <span class="s">&quot;Please reset your password by clicking here: &lt;a href=\&quot;&quot;</span> <span class="p">+</span> <span class="n">callbackUrl</span> <span class="p">+</span> <span class="s">&quot;\&quot;&gt;link&lt;/a&gt;&quot;</span><span class="p">);</span>
</span><span class="hll">        <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="s">&quot;ForgotPasswordConfirmation&quot;</span><span class="p">);</span>
</span>    <span class="p">}</span>

    <span class="c1">// If we got this far, something failed, redisplay form</span>
    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</pre></div>
</div>
<p>Uncomment the highlighted <code class="docutils literal"><span class="pre">ForgotPassword</span></code> from in the <em>Views/Account/ForgotPassword.cshtml</em> view file.</p>
<div class="highlight-html"><div class="highlight"><pre>@model ForgotPasswordViewModel
@{
    ViewData[&quot;Title&quot;] = &quot;Forgot your password?&quot;;
}

<span class="nt">&lt;h2&gt;</span>@ViewData[&quot;Title&quot;].<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;p&gt;</span>
    For more information on how to enable reset password please see this <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://go.microsoft.com/fwlink/?LinkID=532713&quot;</span><span class="nt">&gt;</span>article<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>

<span class="hll"><span class="nt">&lt;form</span> <span class="na">asp-controller=</span><span class="s">&quot;Account&quot;</span> <span class="na">asp-action=</span><span class="s">&quot;ForgotPassword&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">class=</span><span class="s">&quot;form-horizontal&quot;</span> <span class="na">role=</span><span class="s">&quot;form&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">    <span class="nt">&lt;h4&gt;</span>Enter your email.<span class="nt">&lt;/h4&gt;</span>
</span><span class="hll">    <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
</span><span class="hll">    <span class="nt">&lt;div</span> <span class="na">asp-validation-summary=</span><span class="s">&quot;ValidationSummary.All&quot;</span> <span class="na">class=</span><span class="s">&quot;text-danger&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class="hll">    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="nt">&lt;label</span> <span class="na">asp-for=</span><span class="s">&quot;Email&quot;</span> <span class="na">class=</span><span class="s">&quot;col-md-2 control-label&quot;</span><span class="nt">&gt;&lt;/label&gt;</span>
</span><span class="hll">        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-10&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;input</span> <span class="na">asp-for=</span><span class="s">&quot;Email&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span> <span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;span</span> <span class="na">asp-validation-for=</span><span class="s">&quot;Email&quot;</span> <span class="na">class=</span><span class="s">&quot;text-danger&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/div&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/div&gt;</span>
</span><span class="hll">    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-offset-2 col-md-10&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">class=</span><span class="s">&quot;btn btn-default&quot;</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/div&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/div&gt;</span>
</span><span class="hll"><span class="nt">&lt;/form&gt;</span>
</span>
@section Scripts {
    @{ await Html.RenderPartialAsync(&quot;_ValidationScriptsPartial&quot;); }
}
</pre></div>
</div>
</div>
<div class="section" id="register-confirm-email-and-reset-password">
<h2>Register, confirm email, and reset password<a class="headerlink" href="#register-confirm-email-and-reset-password" title="Permalink to this headline">¶</a></h2>
<p>In this section, run the web app and show the account confirmation and password recovery flow.</p>
<ul class="simple">
<li>Run the application and register a new user</li>
</ul>
<img alt="../_images/loginaccconfirm1.png" src="../_images/loginaccconfirm1.png" />
<ul>
<li><p class="first">Check your email for the account confirmation link. If you don&#8217;t get the email notification:</p>
<blockquote>
<div><ul class="simple">
<li>Check the SendGrid web site to verify your sent mail messages.</li>
<li>Check your spam folder.</li>
<li>Try another email alias on a different email provider (Microsoft, Yahoo, Gmail, etc.)</li>
<li>In SSOX, navigate to <strong>dbo.AspNetUsers</strong> and delete the email entry and try again.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Click the link to confirm your email.</p>
</li>
<li><p class="first">Log in with your email and password.</p>
</li>
<li><p class="first">Log off.</p>
</li>
</ul>
<div class="section" id="test-password-reset">
<h3>Test password reset<a class="headerlink" href="#test-password-reset" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Login and select <strong>Forgot your password?</strong></li>
<li>Enter the email you used to register the account.</li>
<li>An email with a link to reset your password will be sent. Check your email and click the link to reset your password.  After your password has been successfully reset, you can login with your email and new password.</li>
</ul>
</div>
</div>
<div class="section" id="require-email-confirmation-before-login">
<h2>Require email confirmation before login<a class="headerlink" href="#require-email-confirmation-before-login" title="Permalink to this headline">¶</a></h2>
<p>With the current templates, once a user completes the registration form, they are logged in (authenticated). You generally want to confirm their email before logging them in. In the section below, we will modify the code to require new users have a confirmed email before they are logged in. Update the <code class="docutils literal"><span class="pre">[HttpPost]</span> <span class="pre">Login</span></code> action in the <em>AccountController.cs</em> file with the following highlighted changes.</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="c1">//</span>
<span class="c1">// POST: /Account/Login</span>
<span class="na">[HttpPost]</span>
<span class="na">[AllowAnonymous]</span>
<span class="na">[ValidateAntiForgeryToken]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="n">Login</span><span class="p">(</span><span class="n">LoginViewModel</span> <span class="n">model</span><span class="p">,</span> <span class="kt">string</span> <span class="n">returnUrl</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">EnsureDatabaseCreated</span><span class="p">(</span><span class="n">_applicationDbContext</span><span class="p">);</span>
    <span class="n">ViewData</span><span class="p">[</span><span class="s">&quot;ReturnUrl&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">returnUrl</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
    <span class="p">{</span>
<span class="hll">        <span class="c1">// Require the user to have a confirmed email before they can log on.</span>
</span><span class="hll">        <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="n">FindByNameAsync</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">Email</span><span class="p">);</span>
</span><span class="hll">        <span class="k">if</span> <span class="p">(</span><span class="n">user</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span><span class="hll">        <span class="p">{</span>
</span><span class="hll">            <span class="k">if</span> <span class="p">(!</span><span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="n">IsEmailConfirmedAsync</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
</span><span class="hll">            <span class="p">{</span>
</span><span class="hll">                <span class="n">ModelState</span><span class="p">.</span><span class="n">AddModelError</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">,</span> <span class="s">&quot;You must have a confirmed email to log in.&quot;</span><span class="p">);</span>
</span><span class="hll">                <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">        <span class="p">}</span>
</span>        <span class="c1">// This doesn&#39;t count login failures towards account lockout</span>
        <span class="c1">// To enable password failures to trigger account lockout, set lockoutOnFailure: true</span>
        <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_signInManager</span><span class="p">.</span><span class="n">PasswordSignInAsync</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">Password</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">RememberMe</span><span class="p">,</span> <span class="n">lockoutOnFailure</span><span class="p">:</span> <span class="k">false</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Succeeded</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">RedirectToLocal</span><span class="p">(</span><span class="n">returnUrl</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">RequiresTwoFactor</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">RedirectToAction</span><span class="p">(</span><span class="n">nameof</span><span class="p">(</span><span class="n">SendCode</span><span class="p">),</span> <span class="k">new</span> <span class="p">{</span> <span class="n">ReturnUrl</span> <span class="p">=</span> <span class="n">returnUrl</span><span class="p">,</span> <span class="n">RememberMe</span> <span class="p">=</span> <span class="n">model</span><span class="p">.</span><span class="n">RememberMe</span> <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">IsLockedOut</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="s">&quot;Lockout&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">ModelState</span><span class="p">.</span><span class="n">AddModelError</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">,</span> <span class="s">&quot;Invalid login attempt.&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// If we got this far, something failed, redisplay form</span>
    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A security best practice is to not use production secrets in test and development. If you publish the app to Azure, you can set the SendGrid secrets as application settings in the Azure Web App portal. The configuration system is setup to read keys from environment variables.</p>
</div>
</div>
<div class="section" id="combine-social-and-local-login-accounts">
<h2>Combine social and local login accounts<a class="headerlink" href="#combine-social-and-local-login-accounts" title="Permalink to this headline">¶</a></h2>
<p>To complete this section, you must first enable an external authentication provider. See <a class="reference internal" href="sociallogins.html"><em>Enabling authentication using external providers</em></a>.</p>
<p>You can combine local and social accounts by clicking on your email link. In the following sequence &#8220;<a class="reference external" href="mailto:RickAndMSFT&#37;&#52;&#48;gmail&#46;com">RickAndMSFT<span>&#64;</span>gmail<span>&#46;</span>com</a>&#8221; is first created as a local login, but you can create the account as a social login first, then add a local login.</p>
<img alt="../_images/rick.png" src="../_images/rick.png" />
<p>Click on the <strong>Manage</strong> link. Note the 0 external (social logins) associated with this account.</p>
<img alt="../_images/manage.png" src="../_images/manage.png" />
<p>Click the link to another login service and accept the app requests. In the image below, Facebook is the external authentication provider:</p>
<img alt="../_images/fb.png" src="../_images/fb.png" />
<p>The two accounts have been combined. You will be able to log on with either account. You might want your users to add local accounts in case their social log in authentication service is down, or more likely they have lost access to their social account.</p>
</div>
</div>



  <!-- Helpfulness -->
  <div id="helpful-position"></div>
  <div id="helpful" class="helpfulness-container fixed" style="display:none;">
    <div class="helpfulness">
      <div class="helpfulness-form">
        <h2>Was this page helpful?</h2>
        <span>Your feedback about this content is important. Let us know what you think.</span>
        <a id="helpfulness-btn-yes" href="javascript:;" class="common-btn first">Yes</a>
        <a id="helpfulness-btn-no" href="javascript:;" class="common-btn">No</a>
      </div>
      <div class="helpfulness-form-no" style="display:none;">
        <h2>Was this page helpful?</h2>
        Sorry this wasn't helpful.
        <input type="text" id="txt-helpfulness" placeholder="Please let us know why this wasn't helpful">
        <span id="helpfulness-characters-left">characters remaining</span>
        <a id="helpfulness-btn-submit" href="javascript:;" class="common-btn">Submit</a>
        <a id="helpfulness-btn-skip" href="javascript:;" class="common-btn secondary">Skip this</a>
      </div>
      <a href="javascript:;" class="helpfulness-close">✖</a>
      <div class="messages processing" style="display:none;">
        Sending feedback...
      </div>
      <div class="messages success" style="display:none;">
        Thank you for your feedback!
      </div>
      <div class="messages error" style="display:none;">
        Error during submission!
      </div>
    </div>
  </div>

  <!-- wedc -->
  <noscript>
    <img alt="" width="1" height="1" src="https://c.microsoft.com/trans_pixel.aspx"/>
  </noscript>

  
  <!-- disqus commenting disabled; set disqus_shortname -->
  
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="2fa.html" class="btn btn-neutral float-right" title="Two-factor authentication with SMS using ASP.NET Identity" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sociallogins.html" class="btn btn-neutral" title="Enabling authentication using external providers" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Microsoft.
      Last updated on Nov 12, 2015.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
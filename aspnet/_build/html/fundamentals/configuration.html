

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuration &mdash; ASP.NET 0.0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css?v=1" type="text/css" />
  

  
    <link rel="top" title="ASP.NET 0.0.1 documentation" href="../index.html"/>
        <link rel="up" title="Fundamentals" href="index.html"/>
        <link rel="next" title="|stub-icon| Dependency Injection" href="dependency-injection.html"/>
        <link rel="prev" title="|stub-icon| Routing" href="routing.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ASP.NET
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conceptual-overview/index.html">Conceptual Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Fundamentals</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="startup.html">Application Startup</a></li>
<li class="toctree-l2"><a class="reference internal" href="http-abstractions.html">|stub-icon| HTTP Abstractions</a></li>
<li class="toctree-l2"><a class="reference internal" href="middleware.html">Middleware</a></li>
<li class="toctree-l2"><a class="reference internal" href="static-files.html">Working with Static Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="file-system.html">|stub-icon| File System</a></li>
<li class="toctree-l2"><a class="reference internal" href="routing.html">|stub-icon| Routing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Configuration</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dependency-injection.html">|stub-icon| Dependency Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostics.html">Diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="application-insights.html">Application Insights</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="app-state.html">|stub-icon| Managing Application State</a></li>
<li class="toctree-l2"><a class="reference internal" href="environments.html">Working with Multiple Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="websockets.html">|stub-icon| WebSockets</a></li>
<li class="toctree-l2"><a class="reference internal" href="caching.html">|stub-icon| Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="error-handling.html">|stub-icon| Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="request-features.html">Request Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="servers.html">Servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="owin.html">OWIN</a></li>
<li class="toctree-l2"><a class="reference internal" href="hosting.html">|stub-icon| Hosting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dnx/index.html">.NET Execution Environment (DNX)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frameworks/index.html">Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/index.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publishing/index.html">Publishing and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client-side/index.html">Client-Side Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/index.html">Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration/index.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ASP.NET</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Fundamentals</a> &raquo;</li>
      
    <li>Configuration</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/fundamentals/configuration.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
  <div class="section" id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<p>By <a class="reference external" href="http://blog.falafel.com/author/steve-smith/">Steve Smith</a> and <a class="reference external" href="https://github.com/danroth27">Daniel Roth</a></p>
<p>ASP.NET 5 supports a variety of different configuration options. Application configuration data can come from files using built-in support for JSON, XML, and INI formats, as well as from environment variables. You can also write your own <a class="reference internal" href="#custom-config-providers"><span>custom configuration provider</span></a>.</p>
<dl class="docutils">
<dt>In this article:</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#getting-and-setting-configuration-settings">Getting and setting configuration settings</a></li>
<li><a class="reference internal" href="#using-the-built-in-providers">Using the built-in providers</a></li>
<li><a class="reference internal" href="#using-options-and-configuration-objects">Using Options and configuration objects</a></li>
<li><a class="reference internal" href="#writing-custom-providers">Writing custom providers</a></li>
</ul>
</dd>
</dl>
<p><a class="reference external" href="https://github.com/aspnet/docs">Download sample from GitHub</a>.</p>
<div class="section" id="getting-and-setting-configuration-settings">
<h2>Getting and setting configuration settings<a class="headerlink" href="#getting-and-setting-configuration-settings" title="Permalink to this headline">¶</a></h2>
<p>ASP.NET 5&#8217;s configuration system has been re-architected from previous versions of ASP.NET, which relied on <code class="docutils literal"><span class="pre">System.Configuration</span></code> and XML configuration files like <code class="docutils literal"><span class="pre">web.config</span></code>. The new <a class="reference external" href="https://github.com/aspnet/Configuration">configuration model</a> provides streamlined access to key/value based settings that can be retrieved from a variety of sources. Applications and frameworks can then access configured settings using the new <a class="reference internal" href="#options-config-objects"><span>Options pattern</span></a></p>
<p>To work with settings in your ASP.NET application, it is recommended that you only instantiate an instance of <code class="docutils literal"><span class="pre">Configuration</span></code> in your application&#8217;s <code class="docutils literal"><span class="pre">Startup</span></code> class. Then, use the <a class="reference internal" href="#options-config-objects"><span>Options pattern</span></a> to access individual settings.</p>
<p>At its simplest, the <code class="docutils literal"><span class="pre">Configuration</span></code> class is just a collection of <code class="docutils literal"><span class="pre">Sources</span></code>, which provide the ability to read and write name/value pairs. You must configure at least one source in order for <code class="docutils literal"><span class="pre">Configuration</span></code> to function correctly. The following sample shows how to test working with <code class="docutils literal"><span class="pre">Configuration</span></code> as a key/value store:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// assumes using Microsoft.Framework.ConfigurationModel is specified</span>
<span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConfigurationBuilder</span><span class="p">();</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">MemoryConfigurationSource</span><span class="p">());</span>
<span class="kt">var</span> <span class="n">config</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="n">Build</span><span class="p">();</span>
<span class="n">config</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;somekey&quot;</span><span class="p">,</span> <span class="s">&quot;somevalue&quot;</span><span class="p">);</span>

<span class="c1">// do some other work</span>

<span class="kt">string</span> <span class="n">setting</span> <span class="p">=</span> <span class="n">config</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="s">&quot;somekey&quot;</span><span class="p">);</span> <span class="c1">// returns &quot;somevalue&quot;</span>
<span class="c1">// or</span>
<span class="kt">string</span> <span class="n">setting2</span> <span class="p">=</span> <span class="n">config</span><span class="p">[</span><span class="s">&quot;somekey&quot;</span><span class="p">];</span> <span class="c1">// also returns &quot;somevalue&quot;</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must set at least one configuration source.</p>
</div>
<p>It&#8217;s not unusual to store configuration values in a hierarchical structure, especially when using external files (e.g. JSON, XML, INI). In this case, configuration values can be retrieved using a <code class="docutils literal"><span class="pre">:</span></code> separated key, starting from the root of the hierarchy. For example, consider the following <em>appsettings.json</em> file:</p>
<div class="highlight-json" id="config-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>
  <span class="nt">&quot;Data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;DefaultConnection&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;ConnectionString&quot;</span><span class="p">:</span> <span class="s2">&quot;Server=(localdb)\\mssqllocaldb;Database=aspnet5-WebApplication1-3ce49aae-711e-451b-bc7e-98ac021b2ef7;Trusted_Connection=True;MultipleActiveResultSets=true&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The application uses configuration to configure the right connection string. Access to the <code class="docutils literal"><span class="pre">ConnectionString</span></code> setting is achieved through this key: <code class="docutils literal"><span class="pre">Data:DefaultConnection:ConnectionString</span></code>.</p>
<p>The settings required by your application and the mechanism used to specify those settings (configuration being one example) can be decoupled using the <a class="reference internal" href="#options-config-objects"><span>options pattern</span></a>. To use the options pattern you create your own settings class (probably several different classes, corresponding to different cohesive groups of settings) that you can inject into your application using an options service. You can then specify your settings using configuration or whatever mechanism you choose.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You could store your <code class="docutils literal"><span class="pre">Configuration</span></code> instance as a service, but this would unnecessarily couple your application to a single configuration system and specific configuration keys. Instead, you can use the <a class="reference internal" href="#options-config-objects"><span>Options pattern</span></a> to avoid these issues.</p>
</div>
</div>
<div class="section" id="using-the-built-in-providers">
<h2>Using the built-in providers<a class="headerlink" href="#using-the-built-in-providers" title="Permalink to this headline">¶</a></h2>
<p>The configuration framework has built-in support for JSON, XML, and INI configuration files, as well as support for in-memory configuration (directly setting values in code) and the ability to pull configuration from environment variables and command line parameters. Developers are not limited to using a single configuration source. In fact several may be set up together such that a default configuration is overridden by settings from another source if they are present.</p>
<p>Adding support for additional configuration file sources is accomplished through extension methods. These methods can be called on a <code class="docutils literal"><span class="pre">ConfigurationBuilder</span></code> instance in a standalone fashion, or chained together as a fluent API, as shown.</p>
<div class="highlight-c#" id="custom-config"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConfigurationBuilder</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">);</span>
<span class="n">builder</span><span class="p">.</span><span class="n">AddJsonFile</span><span class="p">(</span><span class="s">&quot;appsettings.json&quot;</span><span class="p">);</span>
<span class="n">builder</span><span class="p">.</span><span class="n">AddEnvironmentVariables</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">config</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="n">Build</span><span class="p">();</span>
</pre></div>
</td></tr></table></div>
<p>The order in which configuration sources are specified is important, as this establishes the precedence with which settings will be applied if they exist in multiple locations. In the example above, if the same setting exists in both <em>appsettings.json</em> and in an environment variable, the setting from the environment variable will be the one that is used. Essentially, the last configuration source specified &#8220;wins&#8221; if a setting exists in more than one location.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To override nested keys through environment variables in shells that don&#8217;t support <code class="docutils literal"><span class="pre">:</span></code> in variable names replace them with <code class="docutils literal"><span class="pre">__</span></code> (double underscore).</p>
</div>
<p>It can be useful to have environment-specific configuration files. This can be achieved using the following:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="hll">public Startup(IHostingEnvironment env, IApplicationEnvironment appEnv)
</span>{
    // Setup configuration sources.

    var builder = new ConfigurationBuilder()
        .SetBasePath(appEnv.ApplicationBasePath)
        .AddJsonFile(&quot;appsettings.json&quot;)
<span class="hll">        .AddJsonFile($&quot;appsettings.{env.EnvironmentName}.json&quot;, optional: true);
</span>
    if (env.IsDevelopment())
    {
        // This reads the configuration keys from the secret store.
        // For more details on using the user secret store see http://go.microsoft.com/fwlink/?LinkID=532709
        builder.AddUserSecrets();
    }
    builder.AddEnvironmentVariables();
    Configuration = builder.Build();
</pre></div>
</td></tr></table></div>
<p>The <code class="docutils literal"><span class="pre">IHostingEnvironment</span></code> service is used to get the current environment. In the <code class="docutils literal"><span class="pre">Development</span></code> environment, the highlighted line of code above would look for a file named <code class="docutils literal"><span class="pre">appsettings.Development.json</span></code> and use its values, overriding any other values, if it&#8217;s present. Learn more about <a class="reference internal" href="environments.html"><em>Working with Multiple Environments</em></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You should never store passwords or other sensitive data in source code or in plain text configuration files. You also shouldn&#8217;t use production secrets in your development or test environments. Instead, such secrets should be specified outside the project tree, so they cannot be accidentally committed into the source repository. Learn more about <a class="reference internal" href="environments.html"><em>Working with Multiple Environments</em></a> and managing <a class="reference internal" href="../security/app-secrets.html"><em>Safe Storage of Application Secrets</em></a>.</p>
</div>
<p>One way to leverage the order precedence of <code class="docutils literal"><span class="pre">Configuration</span></code> is to specify default values, which can be overridden. In this simple console application, a default value for the <code class="docutils literal"><span class="pre">username</span></code> setting is specified in a <code class="docutils literal"><span class="pre">MemoryConfigurationSource</span></code>, but this is overridden if a command line argument for <code class="docutils literal"><span class="pre">username</span></code> is passed to the application. You can see in the output how many configuration sources are configured at each stage of the program.</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre>using System;
using System.Linq;
using Microsoft.Framework.Configuration;

namespace ConfigConsole
{
    public class Program
    {
        public void Main(string[] args)
        {
            var builder = new ConfigurationBuilder();
            Console.WriteLine(&quot;Initial Config Sources: &quot; + builder.Sources.Count());

            var defaultSettings = new MemoryConfigurationSource();
            defaultSettings.Set(&quot;username&quot;, &quot;Guest&quot;);
            builder.Add(defaultSettings);
            Console.WriteLine(&quot;Added Memory Source. Sources: &quot; + builder.Sources.Count());

            builder.AddCommandLine(args);
            Console.WriteLine(&quot;Added Command Line Source. Sources: &quot; + builder.Sources.Count());

            var config = builder.Build();
            string username = config.Get(&quot;username&quot;);

            Console.WriteLine($&quot;Hello, {username}!&quot;);
        }
    }
}
</pre></div>
</td></tr></table></div>
<p>When run, the program will display the default value unless a command line parameter overrides it.</p>
<img alt="../_images/config-console.png" src="../_images/config-console.png" />
</div>
<div class="section" id="using-options-and-configuration-objects">
<span id="options-config-objects"></span><h2>Using Options and configuration objects<a class="headerlink" href="#using-options-and-configuration-objects" title="Permalink to this headline">¶</a></h2>
<p>Using <a class="reference external" href="https://github.com/aspnet/Options">Options</a> you can easily convert any class (or POCO - Plain Old CLR Object) into a settings class. It&#8217;s recommended that you create well-factored settings objects that correspond to certain features within your application, thus following the Interface Segregation Principle (ISP) (classes depend only on the configuration settings they use) as well as Separation of Concerns (settings for disparate parts of your app are managed separately, and thus are less likely to negatively impact one another).</p>
<p>A simple <code class="docutils literal"><span class="pre">MyOptions</span></code> class is shown here:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">MyOptions</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Option1</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Option2</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Options can be injected into your application using the <code class="docutils literal"><span class="pre">IOptions&lt;TOptions&gt;</span></code> service. For example, the following <a class="reference external" href="http://docs.asp.net/projects/mvc/en/latest/index.html#index" title="(in ASP.NET MVC v0.0.1)"><span class="xref std std-ref">MVC</span></a> controller uses <code class="docutils literal"><span class="pre">IOptions&lt;MyOptions&gt;</span></code> to access the settings it needs to render the <code class="docutils literal"><span class="pre">Index</span></code> view:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">HomeController</span> <span class="p">:</span> <span class="n">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">HomeController</span><span class="p">(</span><span class="n">IOptions</span><span class="p">&lt;</span><span class="n">MyOptions</span><span class="p">&gt;</span> <span class="n">optionsAccessor</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Options</span> <span class="p">=</span> <span class="n">optionsAccessor</span><span class="p">.</span><span class="n">Options</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">MyOptions</span> <span class="n">Options</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">Options</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Learn more about <a class="reference internal" href="dependency-injection.html"><em>|stub-icon| Dependency Injection</em></a>.</p>
<p>To setup the <code class="docutils literal"><span class="pre">IOptions&lt;TOption&gt;</span></code> service you call the <code class="docutils literal"><span class="pre">AddOptions()</span></code> extension method during startup in your <code class="docutils literal"><span class="pre">ConfigureServices</span></code> method:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Setup options with DI</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddOptions</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p id="options-example">The <code class="docutils literal"><span class="pre">Index</span></code> view displays the configured options:</p>
<img alt="../_images/index-view.png" src="../_images/index-view.png" />
<p>You configure options using the <code class="docutils literal"><span class="pre">Configure&lt;TOption&gt;</span></code> extension method. You can configure options using a delegate or by binding your options to configuration:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Setup options with DI</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddOptions</span><span class="p">();</span>

    <span class="c1">// Configure MyOptions using config</span>
<span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">Configure</span><span class="p">&lt;</span><span class="n">MyOptions</span><span class="p">&gt;(</span><span class="n">Configuration</span><span class="p">);</span>
</span>
    <span class="c1">// Configure MyOptions using code</span>
<span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">Configure</span><span class="p">&lt;</span><span class="n">MyOptions</span><span class="p">&gt;(</span><span class="n">myOptions</span> <span class="p">=&gt;</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">myOptions</span><span class="p">.</span><span class="n">Option1</span> <span class="p">=</span> <span class="s">&quot;value1_from_action&quot;</span><span class="p">;</span>
</span><span class="hll">    <span class="p">});</span>
</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddMvc</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>When you bind options to configuration each property in your options type is bound to a configuration key of the form <code class="docutils literal"><span class="pre">property:subproperty:...</span></code>. For example, the <code class="docutils literal"><span class="pre">MyOptions.Option1</span></code> property is bound to the key <code class="docutils literal"><span class="pre">Option1</span></code>, which is read from the <code class="docutils literal"><span class="pre">option1</span></code> property in <em>appsettings.json</em>. Note that configuration keys are case insensitive.</p>
<p>Each call to <code class="docutils literal"><span class="pre">Configure&lt;TOption&gt;</span></code> adds an <code class="docutils literal"><span class="pre">IConfigureOptions&lt;TOption&gt;</span></code> service to the service container that is used by the <code class="docutils literal"><span class="pre">IOptions&lt;TOption&gt;</span></code> service to provide the configured options to the application or framework. If you want to configure your options some other way (ex. reading settings from a data base) you can use the <code class="docutils literal"><span class="pre">ConfigureOptions&lt;TOptions&gt;</span></code> extension method to you specify a custom <code class="docutils literal"><span class="pre">IConfigureOptions&lt;TOption&gt;</span></code> service directly.</p>
<p>You can have multiple <code class="docutils literal"><span class="pre">IConfigureOptions&lt;TOption&gt;</span></code> services for the same option type and they are all applied in order. In the <a class="reference internal" href="#options-example"><span>example</span></a> above value of Option1 and Option2 are both specified in <cite>appsettings.json</cite>, but the value of Option1 is overridden by the configured delegate.</p>
</div>
<div class="section" id="writing-custom-providers">
<span id="custom-config-providers"></span><h2>Writing custom providers<a class="headerlink" href="#writing-custom-providers" title="Permalink to this headline">¶</a></h2>
<p>In addition to using <a class="reference external" href="https://github.com/aspnet/Configuration/tree/dev/src">the built-in configuration source providers</a>, you can also write your own. To do so, you simply inherit from <code class="docutils literal"><span class="pre">ConfigurationSource</span></code>, and populate the <code class="docutils literal"><span class="pre">Data</span></code> property with the settings from your configuration source.</p>
<div class="section" id="example-entity-framework-settings">
<h3>Example: Entity Framework Settings<a class="headerlink" href="#example-entity-framework-settings" title="Permalink to this headline">¶</a></h3>
<p>You may wish to store some of your application&#8217;s settings in a database, and access them using Entity Framework (EF). There are many ways in which you could choose to store such values, ranging from a simple table with a column for the setting name and another column for the setting value, to having separate columns for each setting value. In this example, I&#8217;m going to create a simple configuration source that reads name-value pairs from a database using EF.</p>
<p>To start off we&#8217;ll define a simple <code class="docutils literal"><span class="pre">ConfigurationValue</span></code> entity for storing configuration values in the database:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">ConfigurationValue</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Value</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>We also need a <code class="docutils literal"><span class="pre">ConfigurationContext</span></code> to store and access the configured values using EF:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">ConfigurationContext</span> <span class="p">:</span> <span class="n">DbContext</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">ConfigurationContext</span><span class="p">(</span><span class="n">DbContextOptions</span> <span class="n">options</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">ConfigurationValue</span><span class="p">&gt;</span> <span class="n">Values</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Next, create the custom configuration source by inheriting from <code class="docutils literal"><span class="pre">ConfigurationSource</span></code>. The configuration data is loaded by overriding the <code class="docutils literal"><span class="pre">Load</span></code> method, which reads in all of the configuration data from the configured database. For demonstration purposes, the configuration source also takes care of initializing the database if it hasn&#8217;t already been created and populated:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">EntityFrameworkConfigurationSource</span> <span class="p">:</span> <span class="n">ConfigurationSource</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">EntityFrameworkConfigurationSource</span><span class="p">(</span><span class="n">Action</span><span class="p">&lt;</span><span class="n">DbContextOptionsBuilder</span><span class="p">&gt;</span> <span class="n">optionsAction</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">OptionsAction</span> <span class="p">=</span> <span class="n">optionsAction</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Action</span><span class="p">&lt;</span><span class="n">DbContextOptionsBuilder</span><span class="p">&gt;</span> <span class="n">OptionsAction</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Load</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DbContextOptionsBuilder</span><span class="p">&lt;</span><span class="n">ConfigurationContext</span><span class="p">&gt;();</span>
        <span class="n">OptionsAction</span><span class="p">(</span><span class="n">builder</span><span class="p">);</span>

        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dbContext</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConfigurationContext</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Options</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">dbContext</span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="n">EnsureCreated</span><span class="p">();</span>
            <span class="n">Data</span> <span class="p">=</span> <span class="p">!</span><span class="n">dbContext</span><span class="p">.</span><span class="n">Values</span><span class="p">.</span><span class="n">Any</span><span class="p">()</span>
                <span class="p">?</span> <span class="n">CreateAndSaveDefaultValues</span><span class="p">(</span><span class="n">dbContext</span><span class="p">)</span>
                <span class="p">:</span> <span class="n">dbContext</span><span class="p">.</span><span class="n">Values</span><span class="p">.</span><span class="n">ToDictionary</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="n">IDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">CreateAndSaveDefaultValues</span><span class="p">(</span><span class="n">ConfigurationContext</span> <span class="n">dbContext</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">configValues</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span>
        <span class="p">{</span>
            <span class="p">{</span> <span class="s">&quot;key1&quot;</span><span class="p">,</span> <span class="s">&quot;value_from_ef_1&quot;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="s">&quot;key2&quot;</span><span class="p">,</span> <span class="s">&quot;value_from_ef_2&quot;</span> <span class="p">}</span>
        <span class="p">};</span>
        <span class="n">dbContext</span><span class="p">.</span><span class="n">Values</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="n">configValues</span>
            <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">ConfigurationValue</span><span class="p">()</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="n">kvp</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">Value</span> <span class="p">=</span> <span class="n">kvp</span><span class="p">.</span><span class="n">Value</span> <span class="p">})</span>
            <span class="p">.</span><span class="n">ToArray</span><span class="p">());</span>
        <span class="n">dbContext</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">configValues</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>By convention we also add an <code class="docutils literal"><span class="pre">AddEntityFramework</span></code> extension method for adding the configuration source:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">EntityFrameworkExtensions</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IConfigurationBuilder</span> <span class="nf">AddEntityFramework</span><span class="p">(</span><span class="k">this</span> <span class="n">IConfigurationBuilder</span> <span class="n">builder</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">DbContextOptionsBuilder</span><span class="p">&gt;</span> <span class="n">setup</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">builder</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">EntityFrameworkConfigurationSource</span><span class="p">(</span><span class="n">setup</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>You can see an example of how to use this custom <code class="docutils literal"><span class="pre">ConfigurationSource</span></code> in your application in the following example. Create a new <code class="docutils literal"><span class="pre">ConfigurationBuilder</span></code> to setup your configuration sources. To add the <code class="docutils literal"><span class="pre">EntityFrameworkConfigurationSource</span></code> you first need to specify the data provider and connection string. How should you configure the connection string? Using configuration of course! Add a <em>appsettings.json</em> file as a configuration source to bootstrap setting up the <code class="docutils literal"><span class="pre">EntityFrameworkConfigurationSource</span></code>. By reusing the same <code class="docutils literal"><span class="pre">ConfigurationBuilder</span></code> any settings specified in the database will override settings specified in <em>appsettings.json</em>:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConfigurationBuilder</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">);</span>
        <span class="n">builder</span><span class="p">.</span><span class="n">AddJsonFile</span><span class="p">(</span><span class="s">&quot;appsettings.json&quot;</span><span class="p">);</span>
        <span class="n">builder</span><span class="p">.</span><span class="n">AddEnvironmentVariables</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">config</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="n">Build</span><span class="p">();</span>

        <span class="n">builder</span><span class="p">.</span><span class="n">AddEntityFramework</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span> <span class="n">options</span><span class="p">.</span><span class="n">UseSqlServer</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&quot;Data:DefaultConnection:ConnectionString&quot;</span><span class="p">]));</span>
        <span class="n">config</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="n">Build</span><span class="p">();</span>

        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;key1={0}&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">));</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;key2={0}&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="s">&quot;key2&quot;</span><span class="p">));</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;key3={0}&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="s">&quot;key3&quot;</span><span class="p">));</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Run the application to see the configured values:</p>
<img alt="../_images/custom-config.png" src="../_images/custom-config.png" />
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>ASP.NET 5 provides a very flexible configuration model that supports a number of different file-based options, as well as command-line, in-memory, and environment variables. It works seamlessly with the options model so that you can inject strongly typed settings into your application or framework. You can create your own custom configuration source providers as well, which can work with or replace the built-in providers, allowing for extreme flexibility.</p>
</div>
</div>



  <!-- Helpfulness -->
  <div id="helpful-position"></div>
  <div id="helpful" class="helpfulness-container fixed" style="display:none;">
    <div class="helpfulness">
      <div class="helpfulness-form">
        <h2>Was this page helpful?</h2>
        <span>Your feedback about this content is important. Let us know what you think.</span>
        <a id="helpfulness-btn-yes" href="javascript:;" class="common-btn first">Yes</a>
        <a id="helpfulness-btn-no" href="javascript:;" class="common-btn">No</a>
      </div>
      <div class="helpfulness-form-no" style="display:none;">
        <h2>Was this page helpful?</h2>
        Sorry this wasn't helpful.
        <input type="text" id="txt-helpfulness" placeholder="Please let us know why this wasn't helpful">
        <span id="helpfulness-characters-left">characters remaining</span>
        <a id="helpfulness-btn-submit" href="javascript:;" class="common-btn">Submit</a>
        <a id="helpfulness-btn-skip" href="javascript:;" class="common-btn secondary">Skip this</a>
      </div>
      <a href="javascript:;" class="helpfulness-close">✖</a>
      <div class="messages processing" style="display:none;">
        Sending feedback...
      </div>
      <div class="messages success" style="display:none;">
        Thank you for your feedback!
      </div>
      <div class="messages error" style="display:none;">
        Error during submission!
      </div>
    </div>
  </div>

  <!-- wedc -->
  <noscript>
    <img alt="" width="1" height="1" src="https://c.microsoft.com/trans_pixel.aspx"/>
  </noscript>

  
  <!-- disqus commenting disabled; set disqus_shortname -->
  
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dependency-injection.html" class="btn btn-neutral float-right" title="|stub-icon| Dependency Injection" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="routing.html" class="btn btn-neutral" title="|stub-icon| Routing" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Microsoft.
      Last updated on Nov 12, 2015.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
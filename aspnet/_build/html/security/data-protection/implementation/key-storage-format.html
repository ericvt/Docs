

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Key Storage Format &mdash; ASP.NET 0.0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/custom.css?v=1" type="text/css" />
  

  
    <link rel="top" title="ASP.NET 0.0.1 documentation" href="../../../index.html"/>
        <link rel="up" title="Implementation" href="index.html"/>
        <link rel="next" title="Ephemeral data protection providers" href="key-storage-ephemeral.html"/>
        <link rel="prev" title="Key Immutability and Changing Settings" href="key-immutability.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> ASP.NET
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../conceptual-overview/index.html">Conceptual Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fundamentals/index.html">Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dnx/index.html">.NET Execution Environment (DNX)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../frameworks/index.html">Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data/index.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publishing/index.html">Publishing and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../client-side/index.html">Client-Side Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mobile/index.html">Mobile</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Security</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../sociallogins.html">Enabling authentication using external providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../accconfirm.html">Account Confirmation and Password Recovery with ASP.NET Identity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2fa.html">Two-factor authentication with SMS using ASP.NET Identity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../authorization/index.html">Authorization</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Data Protection</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using-data-protection.html">Getting Started with the Data Protection APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../consumer-apis/index.html">Consumer APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensibility/index.html">Extensibility APIs</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Implementation</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="authenticated-encryption-details.html">Authenticated encryption details.</a></li>
<li class="toctree-l4"><a class="reference internal" href="subkeyderivation.html">Subkey Derivation and Authenticated Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="context-headers.html">Context headers</a></li>
<li class="toctree-l4"><a class="reference internal" href="key-management.html">Key Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="key-storage-providers.html">Key Storage Providers</a></li>
<li class="toctree-l4"><a class="reference internal" href="key-encryption-at-rest.html">Key Encryption At Rest</a></li>
<li class="toctree-l4"><a class="reference internal" href="key-immutability.html">Key Immutability and Changing Settings</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="">Key Storage Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="key-storage-ephemeral.html">Ephemeral data protection providers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../compatibility/index.html">Compatibility</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../app-secrets.html">Safe Storage of Application Secrets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../anti-request-forgery.html">|stub-icon| Anti-Request Forgery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../open-redirect.html">|stub-icon| Preventing Open Redirect Attacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cross-site-scripting.html">|stub-icon| Preventing Cross-Site Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cors.html">Enabling Cross-Origin Requests (CORS)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../migration/index.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">ASP.NET</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Security</a> &raquo;</li>
      
          <li><a href="../index.html">Data Protection</a> &raquo;</li>
      
          <li><a href="index.html">Implementation</a> &raquo;</li>
      
    <li>Key Storage Format</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/security/data-protection/implementation/key-storage-format.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
  <div class="section" id="key-storage-format">
<span id="data-protection-implementation-key-storage-format"></span><h1>Key Storage Format<a class="headerlink" href="#key-storage-format" title="Permalink to this headline">¶</a></h1>
<p>Objects are stored at rest in XML representation. The default directory for key storage is %LOCALAPPDATA%\ASP.NETDataProtection-Keys\.</p>
<div class="section" id="the-key-element">
<h2>The &lt;key&gt; element<a class="headerlink" href="#the-key-element" title="Permalink to this headline">¶</a></h2>
<p>Keys exist as top-level objects in the key repository. By convention keys have the filename <strong>key-{guid}.xml</strong>, where {guid} is the id of the key. Each such file contains a single key. The format of the file is as follows.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;key</span> <span class="na">id=</span><span class="s">&quot;80732141-ec8f-4b80-af9c-c4d2d1ff8901&quot;</span> <span class="na">version=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;creationDate&gt;</span>2015-03-19T23:32:02.3949887Z<span class="nt">&lt;/creationDate&gt;</span>
  <span class="nt">&lt;activationDate&gt;</span>2015-03-19T23:32:02.3839429Z<span class="nt">&lt;/activationDate&gt;</span>
  <span class="nt">&lt;expirationDate&gt;</span>2015-06-17T23:32:02.3839429Z<span class="nt">&lt;/expirationDate&gt;</span>
  <span class="nt">&lt;descriptor</span> <span class="na">deserializerType=</span><span class="s">&quot;{deserializerType}&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;descriptor&gt;</span>
      <span class="nt">&lt;encryption</span> <span class="na">algorithm=</span><span class="s">&quot;AES_256_CBC&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;validation</span> <span class="na">algorithm=</span><span class="s">&quot;HMACSHA256&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;enc:encryptedSecret</span> <span class="na">decryptorType=</span><span class="s">&quot;{decryptorType}&quot;</span> <span class="na">xmlns:enc=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;encryptedKey&gt;</span>
          <span class="c">&lt;!-- This key is encrypted with Windows DPAPI. --&gt;</span>
          <span class="nt">&lt;value&gt;</span>AQAAANCM...8/zeP8lcwAg==<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/encryptedKey&gt;</span>
      <span class="nt">&lt;/enc:encryptedSecret&gt;</span>
    <span class="nt">&lt;/descriptor&gt;</span>
  <span class="nt">&lt;/descriptor&gt;</span>
<span class="nt">&lt;/key&gt;</span>
</pre></div>
</div>
<p>The &lt;key&gt; element contains the following attributes and child elements:</p>
<ul class="simple">
<li>The key id. This value is treated as authoritative; the filename is simply a nicety for human readability.</li>
<li>The version of the &lt;key&gt; element, currently fixed at 1.</li>
<li>The key&#8217;s creation, activation, and expiration dates.</li>
<li>A &lt;descriptor&gt; element, which contains information on the authenticated encryption implementation contained within this key.</li>
</ul>
<p>In the above example, the key&#8217;s id is {80732141-ec8f-4b80-af9c-c4d2d1ff8901}, it was created and activated on March 19, 2015, and it has a lifetime of 90 days. (Occasionally the activation date might be slightly before the creation date as in this example. This is due to a nit in how the APIs work and is harmless in practice.)</p>
</div>
<div class="section" id="the-descriptor-element">
<h2>The &lt;descriptor&gt; element<a class="headerlink" href="#the-descriptor-element" title="Permalink to this headline">¶</a></h2>
<p>The outer &lt;descriptor&gt; element contains an attribute deserializerType, which is the assembly-qualified name of a type which implements IAuthenticatedEncryptorDescriptorDeserializer. This type is responsible for reading the inner &lt;descriptor&gt; element and for parsing the information contained within.</p>
<p>The particular format of the &lt;descriptor&gt; element depends on the authenticated encryptor implementation encapsulated by the key, and each deserializer type expects a slightly different format for this. In general, though, this element will contain algorithmic information (names, types, OIDs, or similar) and secret key material. In the above example, the descriptor specifies that this key wraps AES-256-CBC encryption + HMACSHA256 validation.</p>
</div>
<div class="section" id="the-encryptedsecret-element">
<h2>The &lt;encryptedSecret&gt; element<a class="headerlink" href="#the-encryptedsecret-element" title="Permalink to this headline">¶</a></h2>
<p>An &lt;encryptedSecret&gt; element which contains the encrypted form of the secret key material may be present if <a class="reference internal" href="key-encryption-at-rest.html#data-protection-implementation-key-encryption-at-rest"><span>encryption of secrets at rest is enabled</span></a>. The attribute decryptorType will be the assembly-qualified name of a type which implements IXmlDecryptor. This type is responsible for reading the inner &lt;encryptedKey&gt; element and decrypting it to recover the original plaintext.</p>
<p>As with &lt;descriptor&gt;, the particular format of the &lt;encryptedSecret&gt; element depends on the at-rest encryption mechanism in use. In the above example, the master key is encrypted using Windows DPAPI per the comment.</p>
</div>
<div class="section" id="the-revocation-element">
<h2>The &lt;revocation&gt; element<a class="headerlink" href="#the-revocation-element" title="Permalink to this headline">¶</a></h2>
<p>Revocations exist as top-level objects in the key repository. By convention revocations have the filename <strong>revocation-{timestamp}.xml</strong> (for revoking all keys before a specific date) or <strong>revocation-{guid}.xml</strong> (for revoking a specific key). Each file contains a single &lt;revocation&gt; element.</p>
<p>For revocations of individual keys, the file contents will be as below.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;revocation</span> <span class="na">version=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;revocationDate&gt;</span>2015-03-20T22:45:30.2616742Z<span class="nt">&lt;/revocationDate&gt;</span>
  <span class="nt">&lt;key</span> <span class="na">id=</span><span class="s">&quot;eb4fc299-8808-409d-8a34-23fc83d026c9&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;reason&gt;</span>human-readable reason<span class="nt">&lt;/reason&gt;</span>
<span class="nt">&lt;/revocation&gt;</span>
</pre></div>
</div>
<p>In this case, only the specified key is revoked. If the key id is &#8220;*&#8221;, however, as in the below example, all keys whose creation date is prior to the specified revocation date are revoked.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;revocation</span> <span class="na">version=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;revocationDate&gt;</span>2015-03-20T15:45:45.7366491-07:00<span class="nt">&lt;/revocationDate&gt;</span>
  <span class="c">&lt;!-- All keys created before the revocation date are revoked. --&gt;</span>
  <span class="nt">&lt;key</span> <span class="na">id=</span><span class="s">&quot;*&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;reason&gt;</span>human-readable reason<span class="nt">&lt;/reason&gt;</span>
<span class="nt">&lt;/revocation&gt;</span>
</pre></div>
</div>
<p>The &lt;reason&gt; element is never read by the system. It is simply a convenient place to store a human-readable reason for revocation.</p>
</div>
</div>



  <!-- Helpfulness -->
  <div id="helpful-position"></div>
  <div id="helpful" class="helpfulness-container fixed" style="display:none;">
    <div class="helpfulness">
      <div class="helpfulness-form">
        <h2>Was this page helpful?</h2>
        <span>Your feedback about this content is important. Let us know what you think.</span>
        <a id="helpfulness-btn-yes" href="javascript:;" class="common-btn first">Yes</a>
        <a id="helpfulness-btn-no" href="javascript:;" class="common-btn">No</a>
      </div>
      <div class="helpfulness-form-no" style="display:none;">
        <h2>Was this page helpful?</h2>
        Sorry this wasn't helpful.
        <input type="text" id="txt-helpfulness" placeholder="Please let us know why this wasn't helpful">
        <span id="helpfulness-characters-left">characters remaining</span>
        <a id="helpfulness-btn-submit" href="javascript:;" class="common-btn">Submit</a>
        <a id="helpfulness-btn-skip" href="javascript:;" class="common-btn secondary">Skip this</a>
      </div>
      <a href="javascript:;" class="helpfulness-close">✖</a>
      <div class="messages processing" style="display:none;">
        Sending feedback...
      </div>
      <div class="messages success" style="display:none;">
        Thank you for your feedback!
      </div>
      <div class="messages error" style="display:none;">
        Error during submission!
      </div>
    </div>
  </div>

  <!-- wedc -->
  <noscript>
    <img alt="" width="1" height="1" src="https://c.microsoft.com/trans_pixel.aspx"/>
  </noscript>

  
  <!-- disqus commenting disabled; set disqus_shortname -->
  
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="key-storage-ephemeral.html" class="btn btn-neutral float-right" title="Ephemeral data protection providers" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="key-immutability.html" class="btn btn-neutral" title="Key Immutability and Changing Settings" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Microsoft.
      Last updated on Nov 12, 2015.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
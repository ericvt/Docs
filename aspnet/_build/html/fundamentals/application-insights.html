

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Application Insights &mdash; ASP.NET 0.0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css?v=1" type="text/css" />
  

  
    <link rel="top" title="ASP.NET 0.0.1 documentation" href="../index.html"/>
        <link rel="up" title="Fundamentals" href="index.html"/>
        <link rel="next" title="Logging" href="logging.html"/>
        <link rel="prev" title="Diagnostics" href="diagnostics.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ASP.NET
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conceptual-overview/index.html">Conceptual Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Fundamentals</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="startup.html">Application Startup</a></li>
<li class="toctree-l2"><a class="reference internal" href="http-abstractions.html">|stub-icon| HTTP Abstractions</a></li>
<li class="toctree-l2"><a class="reference internal" href="middleware.html">Middleware</a></li>
<li class="toctree-l2"><a class="reference internal" href="static-files.html">Working with Static Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="file-system.html">|stub-icon| File System</a></li>
<li class="toctree-l2"><a class="reference internal" href="routing.html">|stub-icon| Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="dependency-injection.html">|stub-icon| Dependency Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostics.html">Diagnostics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Application Insights</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="app-state.html">|stub-icon| Managing Application State</a></li>
<li class="toctree-l2"><a class="reference internal" href="environments.html">Working with Multiple Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="websockets.html">|stub-icon| WebSockets</a></li>
<li class="toctree-l2"><a class="reference internal" href="caching.html">|stub-icon| Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="error-handling.html">|stub-icon| Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="request-features.html">Request Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="servers.html">Servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="owin.html">OWIN</a></li>
<li class="toctree-l2"><a class="reference internal" href="hosting.html">|stub-icon| Hosting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dnx/index.html">.NET Execution Environment (DNX)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frameworks/index.html">Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/index.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publishing/index.html">Publishing and Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client-side/index.html">Client-Side Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/index.html">Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration/index.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ASP.NET</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Fundamentals</a> &raquo;</li>
      
    <li>Application Insights</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/fundamentals/application-insights.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
  <div class="section" id="application-insights">
<h1>Application Insights<a class="headerlink" href="#application-insights" title="Permalink to this headline">¶</a></h1>
<p>By <a class="reference external" href="http://blog.falafel.com/author/steve-smith/">Steve Smith</a></p>
<p><a class="reference external" href="http://azure.microsoft.com/services/application-insights/">Application Insights</a> provides development teams with a 360° view across their live application&#8217;s performance, availability, and usage. It can also <a class="reference external" href="http://azure.microsoft.com/documentation/articles/app-insights-detect-triage-diagnose/">detect and diagnose issues and exceptions</a> in these applications. Telemetry data may be collected from web servers and web clients, as well as desktop  and mobile applications.</p>
<dl class="docutils">
<dt>In this article:</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#getting-started">Getting started</a></li>
<li><a class="reference internal" href="#viewing-activity">Viewing activity</a></li>
</ul>
</dd>
</dl>
<p><a class="reference external" href="https://github.com/aspnet/Docs/tree/master/docs/fundamentals/application-insights/sample">View or download sample on GitHub</a>.</p>
<div class="section" id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p><em>Application Insights, like ASP.NET 5, is in preview.</em></p>
<p>To get started with Application Insights, you will need a subscription to Microsoft Azure. If your team or organization already has a subscription, you can ask the owner to add you to it using your Microsoft account.</p>
<p>Sign in to the <a class="reference external" href="http://portal.azure.com/">Azure portal</a> with your account and create a new Application Insights resource.</p>
<img alt="../_images/azure-create-appinsight.png" src="../_images/azure-create-appinsight.png" />
<p>Choose ASP.NET as the application type. Note the <em>Instrumentation Key</em> (under Settings, Properties) associated with the Application Insights resource you&#8217;ve created (<a class="reference external" href="http://azure.microsoft.com/documentation/articles/app-insights-start-monitoring-app-health-usage/">see detailed instructions with more screenshots here</a>). You will need the instrumentation key in a few moments when you configure your ASP.NET 5 application to use Application Insights.</p>
<p>Next, update <code class="docutils literal"><span class="pre">project.json</span></code> to add a new reference to <code class="docutils literal"><span class="pre">Microsoft.ApplicationInsights.AspNet</span></code> in your <code class="docutils literal"><span class="pre">dependencies</span></code> section, as shown:</p>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre>&quot;dependencies&quot;: {
  &quot;EntityFramework.SqlServer&quot;: &quot;7.0.0-beta6&quot;,
  &quot;EntityFramework.Commands&quot;: &quot;7.0.0-beta6&quot;,
  &quot;Microsoft.AspNet.Mvc&quot;: &quot;6.0.0-beta6&quot;,
  &quot;Microsoft.AspNet.Mvc.TagHelpers&quot;: &quot;6.0.0-beta6&quot;,
  &quot;Microsoft.AspNet.Authentication.Cookies&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.AspNet.Authentication.Facebook&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.AspNet.Authentication.Google&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.AspNet.Authentication.MicrosoftAccount&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.AspNet.Authentication.Twitter&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.AspNet.Diagnostics&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.AspNet.Diagnostics.Entity&quot;: &quot;7.0.0-beta6&quot;,
  &quot;Microsoft.AspNet.Identity.EntityFramework&quot;: &quot;3.0.0-beta6&quot;,
  &quot;Microsoft.AspNet.Server.IIS&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.AspNet.Server.WebListener&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.AspNet.StaticFiles&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.AspNet.Tooling.Razor&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.Framework.Configuration.Abstractions&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.Framework.Configuration.Json&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.Framework.Configuration.UserSecrets&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.Framework.Logging&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.Framework.Logging.Console&quot;: &quot;1.0.0-beta6&quot;,
  &quot;Microsoft.VisualStudio.Web.BrowserLink.Loader&quot;: &quot;14.0.0-beta6&quot;,
<span class="hll">  &quot;Microsoft.ApplicationInsights.AspNet&quot;: &quot;1.0.0-beta6&quot;
</span>},
</pre></div>
</td></tr></table></div>
<p>Saving the <code class="docutils literal"><span class="pre">project.json</span></code> file will download and install the required packages.</p>
<p>Next, edit (or create) the <code class="docutils literal"><span class="pre">config.json</span></code> file, adding the instrumentation key you noted above from your Application Insights resource in Windows Azure. Specify an &#8220;ApplicationInsights&#8221; section with a key named &#8220;InstrumentationKey&#8221;. Set its value to the instrumentation key.</p>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>
<span class="hll">  <span class="nt">&quot;ApplicationInsights&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="hll">    <span class="nt">&quot;InstrumentationKey&quot;</span><span class="p">:</span> <span class="s2">&quot;YOUR KEY GOES HERE&quot;</span>
</span><span class="hll">  <span class="p">},</span>
</span>  <span class="nt">&quot;Data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;DefaultConnection&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;ConnectionString&quot;</span><span class="p">:</span> <span class="s2">&quot;Server=(localdb)\\mssqllocaldb;Database=aspnet5-AppInsightsDemo-8cf4d67e-57bd-4ccb-bdf4-384ca147edf3;Trusted_Connection=True;MultipleActiveResultSets=true&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Next, in <code class="docutils literal"><span class="pre">Startup.cs</span></code> you need to configure Application Insights in a few places. In the constructor, where you configure <code class="docutils literal"><span class="pre">Configuration</span></code>, add a block to configure Application Insights for development:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="n">env</span><span class="p">.</span><span class="n">IsDevelopment</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">// This reads the configuration keys from the secret store.</span>
    <span class="c1">// For more details on using the user secret store see http://go.microsoft.com/fwlink/?LinkID=532709</span>
    <span class="n">builder</span><span class="p">.</span><span class="n">AddUserSecrets</span><span class="p">();</span>

    <span class="c1">// This will push telemetry data through Application Insights pipeline faster, allowing you to view results immediately.</span>
<span class="hll">    <span class="n">builder</span><span class="p">.</span><span class="n">AddApplicationInsightsSettings</span><span class="p">(</span><span class="n">developerMode</span><span class="p">:</span> <span class="k">true</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Setting AppInsights in developerMode (<code class="docutils literal"><span class="pre">configuration.AddApplicationInsightsSettings(developerMode:</span> <span class="pre">true)</span></code>) will expedite your telemetry through the pipeline so that you can see results immediately (<a class="reference external" href="http://azure.microsoft.com/documentation/articles/app-insights-api-custom-events-metrics/#debug">learn more</a>).</p>
</div>
<p>Add the Application Insights telemetry services in your <code class="docutils literal"><span class="pre">ConfigureServices()</span></code> method:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Add Application Insights data collection services to the services container.</span>
<span class="hll">    <span class="n">services</span><span class="p">.</span><span class="n">AddApplicationInsightsTelemetry</span><span class="p">(</span><span class="n">Configuration</span><span class="p">);</span>
</span></pre></div>
</td></tr></table></div>
<p>Then, in the <code class="docutils literal"><span class="pre">Configure()</span></code> method add middleware to allow Application Insights to track exceptions and log information about individual requests. Note that the request tracking middleware should be as the first middleware in the pipeline, while the exception middleware should follow the configuration of error pages or other error handling middleware.</p>
<p>An edited <code class="docutils literal"><span class="pre">Startup.cs</span></code> is shown below, highlighting the necessary Application Insights code (<a class="reference external" href="https://github.com/aspnet/Docs/tree/master/docs/fundamentals/application-insights/sample/AppInsightsDemo/src/AppInsightsDemo/Startup.cs">view full Startup.cs</a>):</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">IApplicationBuilder</span> <span class="n">app</span><span class="p">,</span> <span class="n">IHostingEnvironment</span> <span class="n">env</span><span class="p">,</span> <span class="n">ILoggerFactory</span> <span class="n">loggerFactory</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">loggerFactory</span><span class="p">.</span><span class="n">MinimumLevel</span> <span class="p">=</span> <span class="n">LogLevel</span><span class="p">.</span><span class="n">Information</span><span class="p">;</span>
    <span class="n">loggerFactory</span><span class="p">.</span><span class="n">AddConsole</span><span class="p">();</span>

    <span class="c1">// Configure the HTTP request pipeline.</span>

    <span class="c1">// Add Application Insights to the request pipeline to track HTTP request telemetry data.</span>
<span class="hll">    <span class="n">app</span><span class="p">.</span><span class="n">UseApplicationInsightsRequestTelemetry</span><span class="p">();</span>
</span>
    <span class="c1">// Add the following to the request pipeline only in development environment.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">env</span><span class="p">.</span><span class="n">IsDevelopment</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">app</span><span class="p">.</span><span class="n">UseBrowserLink</span><span class="p">();</span>
        <span class="n">app</span><span class="p">.</span><span class="n">UseErrorPage</span><span class="p">();</span>
        <span class="n">app</span><span class="p">.</span><span class="n">UseDatabaseErrorPage</span><span class="p">(</span><span class="n">DatabaseErrorPageOptions</span><span class="p">.</span><span class="n">ShowAll</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// Add Error handling middleware which catches all application specific errors and</span>
        <span class="c1">// sends the request to the following path or controller action.</span>
        <span class="n">app</span><span class="p">.</span><span class="n">UseErrorHandler</span><span class="p">(</span><span class="s">&quot;/Home/Error&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Track data about exceptions from the application. Should be configured after all error handling middleware in the request pipeline.</span>
<span class="hll">    <span class="n">app</span><span class="p">.</span><span class="n">UseApplicationInsightsExceptionTelemetry</span><span class="p">();</span>
</span></pre></div>
</td></tr></table></div>
<p>Now add the Application Insights scripts to your views. Add the following to the very top of the <code class="docutils literal"><span class="pre">_ViewImports.cshtml</span></code> file:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre>@using AppInsightsDemo
@using AppInsightsDemo.Models
@using Microsoft.AspNet.Identity
@addTagHelper &quot;*, Microsoft.AspNet.Mvc.TagHelpers&quot;
<span class="hll">@inject Microsoft.ApplicationInsights.Extensibility.TelemetryConfiguration TelemetryConfiguration
</span></pre></div>
</td></tr></table></div>
<p>Then, add the following line of code in your <code class="docutils literal"><span class="pre">_Layouts.cshtml</span></code> file at the end of the <code class="docutils literal"><span class="pre">&lt;head&gt;</span></code> section (before any other JavaScript blocks specified there):</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>@ViewData[&quot;Title&quot;] - AppInsightsDemo<span class="nt">&lt;/title&gt;</span>

    <span class="nt">&lt;environment</span> <span class="na">names=</span><span class="s">&quot;Development&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;~/lib/bootstrap/dist/css/bootstrap.css&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;~/lib/bootstrap-touch-carousel/dist/css/bootstrap-touch-carousel.css&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;~/css/site.css&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/environment&gt;</span>
    <span class="nt">&lt;environment</span> <span class="na">names=</span><span class="s">&quot;Staging,Production&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;//ajax.aspnetcdn.com/ajax/bootstrap/3.0.0/css/bootstrap.min.css&quot;</span>
              <span class="na">asp-fallback-href=</span><span class="s">&quot;~/lib/bootstrap/css/bootstrap.min.css&quot;</span>
              <span class="na">asp-fallback-test-class=</span><span class="s">&quot;hidden&quot;</span> <span class="na">asp-fallback-test-property=</span><span class="s">&quot;visibility&quot;</span> <span class="na">asp-fallback-test-value=</span><span class="s">&quot;hidden&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;//ajax.aspnetcdn.com/ajax/bootstrap-touch-carousel/0.8.0/css/bootstrap-touch-carousel.css&quot;</span>
              <span class="na">asp-fallback-href=</span><span class="s">&quot;~/lib/bootstrap-touch-carousel/css/bootstrap-touch-carousel.css&quot;</span>
              <span class="na">asp-fallback-test-class=</span><span class="s">&quot;carousel-caption&quot;</span> <span class="na">asp-fallback-test-property=</span><span class="s">&quot;display&quot;</span> <span class="na">asp-fallback-test-value=</span><span class="s">&quot;none&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;~/css/site.css&quot;</span> <span class="na">asp-file-version=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/environment&gt;</span>
<span class="hll">    @Html.ApplicationInsightsJavaScript(TelemetryConfiguration)
</span><span class="nt">&lt;/head&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="viewing-activity">
<h2>Viewing activity<a class="headerlink" href="#viewing-activity" title="Permalink to this headline">¶</a></h2>
<p>You can view the activity from your site once it&#8217;s been configured and you&#8217;ve made some requests to it by navigating to the Azure portal. There, you will find the Application Insights resource you configured previously, and you will be able to view charts showing performance and activity data:</p>
<img alt="../_images/view-activity.png" src="../_images/view-activity.png" />
<p>In addition to tracking activity and performance data on every page, you can also track specific events. For instance, if you want to know any time a user completes a certain transaction, you can create and track such events individually. To do so, you should inject the TelemetryClient into the controller in question, and call its <code class="docutils literal"><span class="pre">TrackEvent</span></code> method. In the included sample, we&#8217;ve added event tracking for user registration and successful and failed login attempts. You can see the required code in the excerpt from AccountController.cs shown below:</p>
<div class="highlight-c#"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Claims</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Security.Principal</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNet.Authentication</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNet.Authorization</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNet.Identity</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNet.Mvc</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNet.Mvc.Rendering</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.Data.Entity</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.Data.Entity.Infrastructure</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">AppInsightsDemo</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">AppInsightsDemo.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">AppInsightsDemo.Services</span><span class="p">;</span>
<span class="hll"><span class="k">using</span> <span class="nn">Microsoft.ApplicationInsights</span><span class="p">;</span>
</span>
<span class="k">namespace</span> <span class="nn">AppInsightsDemo.Controllers</span>
<span class="p">{</span>
<span class="na">    [Authorize]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">AccountController</span> <span class="p">:</span> <span class="n">Controller</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">UserManager</span><span class="p">&lt;</span><span class="n">ApplicationUser</span><span class="p">&gt;</span> <span class="n">_userManager</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">SignInManager</span><span class="p">&lt;</span><span class="n">ApplicationUser</span><span class="p">&gt;</span> <span class="n">_signInManager</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IEmailSender</span> <span class="n">_emailSender</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ISmsSender</span> <span class="n">_smsSender</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ApplicationDbContext</span> <span class="n">_applicationDbContext</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">static</span> <span class="kt">bool</span> <span class="n">_databaseChecked</span><span class="p">;</span>
<span class="hll">        <span class="k">private</span> <span class="k">readonly</span> <span class="n">TelemetryClient</span> <span class="n">_telemetryClient</span><span class="p">;</span>
</span>
        <span class="k">public</span> <span class="nf">AccountController</span><span class="p">(</span>
            <span class="n">UserManager</span><span class="p">&lt;</span><span class="n">ApplicationUser</span><span class="p">&gt;</span> <span class="n">userManager</span><span class="p">,</span>
            <span class="n">SignInManager</span><span class="p">&lt;</span><span class="n">ApplicationUser</span><span class="p">&gt;</span> <span class="n">signInManager</span><span class="p">,</span>
            <span class="n">IEmailSender</span> <span class="n">emailSender</span><span class="p">,</span>
            <span class="n">ISmsSender</span> <span class="n">smsSender</span><span class="p">,</span>
            <span class="n">ApplicationDbContext</span> <span class="n">applicationDbContext</span><span class="p">,</span>
<span class="hll">            <span class="n">TelemetryClient</span> <span class="n">telemetryClient</span><span class="p">)</span>
</span>        <span class="p">{</span>
            <span class="n">_userManager</span> <span class="p">=</span> <span class="n">userManager</span><span class="p">;</span>
            <span class="n">_signInManager</span> <span class="p">=</span> <span class="n">signInManager</span><span class="p">;</span>
            <span class="n">_emailSender</span> <span class="p">=</span> <span class="n">emailSender</span><span class="p">;</span>
            <span class="n">_smsSender</span> <span class="p">=</span> <span class="n">smsSender</span><span class="p">;</span>
            <span class="n">_applicationDbContext</span> <span class="p">=</span> <span class="n">applicationDbContext</span><span class="p">;</span>
<span class="hll">            <span class="n">_telemetryClient</span> <span class="p">=</span> <span class="n">telemetryClient</span><span class="p">;</span>
</span>        <span class="p">}</span>

        <span class="c1">//</span>
        <span class="c1">// POST: /Account/Login</span>
<span class="na">        [HttpPost]</span>
<span class="na">        [AllowAnonymous]</span>
<span class="na">        [ValidateAntiForgeryToken]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="n">Login</span><span class="p">(</span><span class="n">LoginViewModel</span> <span class="n">model</span><span class="p">,</span> <span class="kt">string</span> <span class="n">returnUrl</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">EnsureDatabaseCreated</span><span class="p">(</span><span class="n">_applicationDbContext</span><span class="p">);</span>
            <span class="n">ViewData</span><span class="p">[</span><span class="s">&quot;ReturnUrl&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">returnUrl</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// This doesn&#39;t count login failures towards account lockout</span>
                <span class="c1">// To enable password failures to trigger account lockout, set lockoutOnFailure: true</span>
                <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_signInManager</span><span class="p">.</span><span class="n">PasswordSignInAsync</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">Password</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">RememberMe</span><span class="p">,</span> <span class="n">lockoutOnFailure</span><span class="p">:</span> <span class="k">false</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Succeeded</span><span class="p">)</span>
                <span class="p">{</span>
<span class="hll">                    <span class="n">_telemetryClient</span><span class="p">.</span><span class="n">TrackEvent</span><span class="p">(</span><span class="s">&quot;LoginSuccess&quot;</span><span class="p">);</span>
</span>                    <span class="k">return</span> <span class="nf">RedirectToLocal</span><span class="p">(</span><span class="n">returnUrl</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">RequiresTwoFactor</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">return</span> <span class="nf">RedirectToAction</span><span class="p">(</span><span class="n">nameof</span><span class="p">(</span><span class="n">SendCode</span><span class="p">),</span> <span class="k">new</span> <span class="p">{</span> <span class="n">ReturnUrl</span> <span class="p">=</span> <span class="n">returnUrl</span><span class="p">,</span> <span class="n">RememberMe</span> <span class="p">=</span> <span class="n">model</span><span class="p">.</span><span class="n">RememberMe</span> <span class="p">});</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">IsLockedOut</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="s">&quot;Lockout&quot;</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
<span class="hll">                    <span class="n">_telemetryClient</span><span class="p">.</span><span class="n">TrackEvent</span><span class="p">(</span><span class="s">&quot;LoginFailure&quot;</span><span class="p">);</span>
</span>                    <span class="n">ModelState</span><span class="p">.</span><span class="n">AddModelError</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">,</span> <span class="s">&quot;Invalid login attempt.&quot;</span><span class="p">);</span>
                    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// If we got this far, something failed, redisplay form</span>
            <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">//</span>
        <span class="c1">// POST: /Account/Register</span>
<span class="na">        [HttpPost]</span>
<span class="na">        [AllowAnonymous]</span>
<span class="na">        [ValidateAntiForgeryToken]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="n">Register</span><span class="p">(</span><span class="n">RegisterViewModel</span> <span class="n">model</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">EnsureDatabaseCreated</span><span class="p">(</span><span class="n">_applicationDbContext</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ApplicationUser</span> <span class="p">{</span> <span class="n">UserName</span> <span class="p">=</span> <span class="n">model</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span> <span class="n">Email</span> <span class="p">=</span> <span class="n">model</span><span class="p">.</span><span class="n">Email</span> <span class="p">};</span>
                <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="n">CreateAsync</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">Password</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Succeeded</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// For more information on how to enable account confirmation and password reset please visit http://go.microsoft.com/fwlink/?LinkID=532713</span>
                    <span class="c1">// Send an email with this link</span>
                    <span class="c1">//var code = await _userManager.GenerateEmailConfirmationTokenAsync(user);</span>
                    <span class="c1">//var callbackUrl = Url.Action(&quot;ConfirmEmail&quot;, &quot;Account&quot;, new { userId = user.Id, code = code }, protocol: Context.Request.Scheme);</span>
                    <span class="c1">//await _emailSender.SendEmailAsync(model.Email, &quot;Confirm your account&quot;,</span>
                    <span class="c1">//    &quot;Please confirm your account by clicking this link: &lt;a href=\&quot;&quot; + callbackUrl + &quot;\&quot;&gt;link&lt;/a&gt;&quot;);</span>
                    <span class="k">await</span> <span class="n">_signInManager</span><span class="p">.</span><span class="n">SignInAsync</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">isPersistent</span><span class="p">:</span> <span class="k">false</span><span class="p">);</span>
<span class="hll">                    <span class="n">_telemetryClient</span><span class="p">.</span><span class="n">TrackEvent</span><span class="p">(</span><span class="s">&quot;NewRegistration&quot;</span><span class="p">);</span>
</span>                    <span class="k">return</span> <span class="nf">RedirectToAction</span><span class="p">(</span><span class="n">nameof</span><span class="p">(</span><span class="n">HomeController</span><span class="p">.</span><span class="n">Index</span><span class="p">),</span> <span class="s">&quot;Home&quot;</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="n">AddErrors</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// If we got this far, something failed, redisplay form</span>
            <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>With this in place, testing the application&#8217;s registration and login feature results in the following activity available for analysis:</p>
<img alt="../_images/view-custom-events.png" src="../_images/view-custom-events.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Application Insights is still in development. To view the latest release notes and configuration instructions, please <a class="reference external" href="https://github.com/Microsoft/ApplicationInsights-aspnet5/wiki/Getting-Started">refer to the project wiki</a>.</p>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Application Insights allows you to easily add application activity and performance tracking to any ASP.NET 5 app. With Application Insights in place, you can view live reports showing information about the users of your application and how it is performing, including both client and server performance information. In addition, you can track custom events, allowing to you capture user activities unique to your application.</p>
</div>
<div class="section" id="additional-resources">
<h2>Additional Resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://azure.microsoft.com/documentation/articles/app-insights-api-custom-events-metrics/">Application Insights API for custom events and metrics</a></li>
<li><a class="reference external" href="http://blogs.msdn.com/b/webdev/archive/2015/05/19/application-insights-for-asp-net-5-you-re-in-control.aspx">Application Insights for ASP.NET 5</a></li>
</ul>
</div>
</div>



  <!-- Helpfulness -->
  <div id="helpful-position"></div>
  <div id="helpful" class="helpfulness-container fixed" style="display:none;">
    <div class="helpfulness">
      <div class="helpfulness-form">
        <h2>Was this page helpful?</h2>
        <span>Your feedback about this content is important. Let us know what you think.</span>
        <a id="helpfulness-btn-yes" href="javascript:;" class="common-btn first">Yes</a>
        <a id="helpfulness-btn-no" href="javascript:;" class="common-btn">No</a>
      </div>
      <div class="helpfulness-form-no" style="display:none;">
        <h2>Was this page helpful?</h2>
        Sorry this wasn't helpful.
        <input type="text" id="txt-helpfulness" placeholder="Please let us know why this wasn't helpful">
        <span id="helpfulness-characters-left">characters remaining</span>
        <a id="helpfulness-btn-submit" href="javascript:;" class="common-btn">Submit</a>
        <a id="helpfulness-btn-skip" href="javascript:;" class="common-btn secondary">Skip this</a>
      </div>
      <a href="javascript:;" class="helpfulness-close">✖</a>
      <div class="messages processing" style="display:none;">
        Sending feedback...
      </div>
      <div class="messages success" style="display:none;">
        Thank you for your feedback!
      </div>
      <div class="messages error" style="display:none;">
        Error during submission!
      </div>
    </div>
  </div>

  <!-- wedc -->
  <noscript>
    <img alt="" width="1" height="1" src="https://c.microsoft.com/trans_pixel.aspx"/>
  </noscript>

  
  <!-- disqus commenting disabled; set disqus_shortname -->
  
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="logging.html" class="btn btn-neutral float-right" title="Logging" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="diagnostics.html" class="btn btn-neutral" title="Diagnostics" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Microsoft.
      Last updated on Nov 12, 2015.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>